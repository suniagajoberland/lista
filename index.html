<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Catálogo - EZVIZ</title>
<style>
  /* Reset */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f4f8;
    color: #333;
    padding-top: 70px; /* Top menu height */
  }
  /* Menú superior */
  header {
    position: fixed;
    top: 0;
    width: 100%;
    height: 70px;
    background: #0052cc;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 25px;
    box-shadow: 0 3px 10px rgba(0, 82, 204, 0.5);
    z-index: 10000;
  }
  header h1 {
    font-weight: 700;
    font-size: 1.8rem;
    letter-spacing: 1.3px;
  }
  #cart-button {
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 1.4rem;
    position: relative;
    display: flex;
    align-items: center;
    gap: 12px;
    user-select: none;
  }
  #cart-button svg {
    width: 28px;
    height: 28px;
    fill: white;
  }
  #cart-count {
    background: #25d366;
    border-radius: 50%;
    padding: 4px 14px;
    font-weight: 700;
    font-size: 1.1rem;
    box-shadow: 0 3px 8px rgba(37, 211, 102, 0.7);
    position: absolute;
    top: -8px;
    right: -12px;
  }
  /* Contenido principal */
  main {
    max-width: 1100px;
    margin: 0 auto 60px;
    padding: 0 15px;
  }
  .catalog {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 24px;
  }
  .product {
    background: white;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0, 82, 204, 0.15);
    width: 280px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease;
  }
  .product:hover {
    transform: translateY(-5px);
  }
  .product img {
    max-width: 100%;
    border-radius: 10px;
    margin-bottom: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .product h3 {
    margin: 0 0 10px 0;
    font-size: 1.25rem;
    color: #003d99;
  }
  .price {
    font-weight: 700;
    color: #007bff;
    font-size: 1.1rem;
    margin-bottom: 15px;
  }
  .specs {
    font-size: 0.94rem;
    color: #555;
    margin-bottom: 18px;
    flex-grow: 1;
    line-height: 1.3;
  }
  input[type=number] {
    width: 60px;
    padding: 7px 8px;
    margin-bottom: 15px;
    border-radius: 6px;
    border: 1.8px solid #c2d4ff;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  input[type=number]:focus {
    border-color: #0052cc;
    outline: none;
  }
  button {
    cursor: pointer;
    border-radius: 8px;
    border: none;
    font-size: 1rem;
    font-weight: 600;
    padding: 11px 16px;
    transition: background-color 0.3s ease;
  }
  button.add-to-cart {
    background: linear-gradient(45deg, #0052cc, #3380ff);
    color: white;
    margin-bottom: 15px;
    box-shadow: 0 6px 12px rgba(51,128,255, 0.5);
  }
  button.add-to-cart:hover {
    background: linear-gradient(45deg, #003d99, #0066ff);
  }
  .btn-group {
    display: flex;
    gap: 10px;
  }
  .btn-whatsapp-product {
    flex: 1;
    background: #25d366;
    color: white;
    box-shadow: 0 4px 10px rgba(37, 211, 102, 0.5);
  }
  .btn-whatsapp-product:hover {
    background: #1ebe57;
  }
  .btn-tech {
    flex: 1;
    background: #007bff;
    color: white;
    box-shadow: 0 4px 10px rgba(0,123,255,0.5);
  }
  .btn-tech:hover {
    background: #0056b3;
  }
  /* Carrito desplegable */
  #cart-details {
    display: none;
    position: fixed;
    top: 80px;
    right: 20px;
    width: 380px;
    max-height: 465px;
    overflow-y: auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(0, 82, 204, 0.4);
    padding: 25px 30px;
    z-index: 1000;
    font-size: 1rem;
  }
  #cart-details h2 {
    margin-top: 0;
    font-size: 1.4rem;
    text-align: center;
    color: #0040b3;
    margin-bottom: 20px;
  }
  .cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 12px;
    border-bottom: 1px solid #e7ecf8;
    margin-bottom: 12px;
  }
  .cart-item:last-child {
    border: none;
    margin-bottom: 0;
  }
  .cart-item-details {
    flex: 1 1 auto;
    color: #222;
  }
  .cart-item-quantity {
    width: 55px;
    height: 32px;
    border-radius: 6px;
    border: 1.5px solid #c2d4ff;
    font-size: 1rem;
    padding-left: 6px;
    transition: border-color 0.3s ease;
  }
  .cart-item-quantity:focus {
    border-color: #0052cc;
    outline: none;
  }
  .cart-remove-btn {
    margin-left: 16px;
    padding: 5px 14px;
    background: #ff4b5c;
    color: white;
    font-weight: 700;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .cart-remove-btn:hover {
    background: #e04351;
  }
  #cart-total {
    font-weight: 700;
    text-align: right;
    margin-top: 18px;
    font-size: 1.2rem;
    color: #0052cc;
  }
  /* Formulario carrito con separación */
  #whatsapp-form {
    margin-top: 30px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    border-top: 1px solid #d1d9ee;
    padding-top: 20px;
  }
  #whatsapp-form label {
    font-weight: 600;
    font-size: 0.95rem;
  }
  #whatsapp-form input, #whatsapp-form textarea {
    padding: 8px 10px;
    border-radius: 6px;
    border: 1.8px solid #c2d4ff;
    font-size: 1rem;
    transition: border-color 0.3s ease;
    resize: vertical;
  }
  #whatsapp-form input:focus, #whatsapp-form textarea:focus {
    border-color: #0052cc;
    outline: none;
  }
  #whatsapp-order {
    background: #25d366;
    color: white;
    border: none;
    padding: 14px;
    width: 100%;
    font-size: 1.15rem;
    border-radius: 12px;
    cursor: pointer;
    margin-top: 10px;
    box-shadow: 0 6px 18px rgba(37, 211, 102, 0.6);
    transition: background-color 0.3s ease;
  }
  #whatsapp-order:disabled {
    background: #a3d9b1;
    cursor: not-allowed;
  }
  #whatsapp-order:hover:enabled {
    background: #1ebe57;
  }
  /* Modal ficha técnica con más separación */
  .modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 70px;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.55);
  }
  .modal-content {
    background-color: #fefefe;
    margin: 12% auto;
    padding: 30px 40px;
    border-radius: 12px;
    width: 95%;
    max-width: 520px;
    color: #224466;
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
    position: relative;
  }
  .close-modal {
    color: #a0a0a0;
    position: absolute;
    top: 14px;
    right: 20px;
    font-size: 28px;
    font-weight: 700;
    cursor: pointer;
    transition: color 0.3s ease;
  }
  .close-modal:hover,
  .close-modal:focus {
    color: #007bff;
  }
  .tech-content {
    margin-top: 25px;
    line-height: 1.5;
    font-size: 1.05rem;
  }
  .btn-fabricante {
    background: #0040b3;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 14px 24px;
    margin-top: 35px;
    cursor: pointer;
    font-weight: 600;
    font-size: 1.1rem;
    width: 100%;
    transition: background-color 0.3s ease;
  }
  .btn-fabricante:hover {
    background: #002d80;
  }

  /* Responsive */
  @media (max-width: 720px) {
    .catalog {
      justify-content: center;
    }
    .product {
      width: 90%;
    }
    #cart-details {
      width: 95%;
      right: 2.5%;
      max-height: 60vh;
      padding: 20px;
    }
    header {
      padding: 0 15px;
    }
  }
</style>
</head>
<body>

<header>
  <h1>Catálogo</h1>
  <button id="cart-button" title="Mostrar Carrito" aria-label="Mostrar Carrito">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13l-1.2 6m0 0a1 1 0 102 0m-2 0h12m-7 0a1 1 0 112 0m-5-6h6" />
    </svg>
    <span id="cart-count">0</span>
  </button>
</header>

<main>
  <div class="catalog" id="catalog">

    <div class="product" data-id="1" data-name="Cámara EZVIZ C3N" data-price="120" data-specs="Resolución 4MP, Visión nocturna, Audio bidireccional" data-tech="Modelo CS-C3N, Resolución 4MP, Visión nocturna hasta 15 m, Audio bidireccional, Sensor CMOS, Almacenamiento microSD hasta 256GB" data-fabricante="https://www.ezviz.com/la/product/c3n/">
      <img src="https://www.example.com/ezviz-c3n.jpg" alt="Cámara EZVIZ C3N" />
      <h3>Cámara EZVIZ C3N</h3>
      <div class="price">$120 USD</div>
      <div class="specs">Resolución 4MP, Visión nocturna, Audio bidireccional</div>
      <input type="number" min="1" value="1" class="quantity-input" aria-label="Cantidad de Cámara EZVIZ C3N" />
      <button class="add-to-cart">Agregar al carrito</button>
      <div class="btn-group">
        <button class="btn-whatsapp-product">Consultar por WhatsApp</button>
        <button class="btn-tech">Ficha Técnica</button>
      </div>
    </div>

    <div class="product" data-id="2" data-name="Cámara EZVIZ C6CN" data-price="150" data-specs="Resolución 1080p, Giro 360°, Zoom 4x" data-tech="Modelo CS-C6CN, Resolución 1080p, Giro 360°, Zoom óptico 4x, Audio bidireccional, Almacenamiento microSD" data-fabricante="https://www.ezviz.com/la/product/c6n/">
      <img src="https://www.example.com/ezviz-c6cn.jpg" alt="Cámara EZVIZ C6CN" />
      <h3>Cámara EZVIZ C6CN</h3>
      <div class="price">$150 USD</div>
      <div class="specs">Resolución 1080p, Giro 360°, Zoom 4x</div>
      <input type="number" min="1" value="1" class="quantity-input" aria-label="Cantidad de Cámara EZVIZ C6CN" />
      <button class="add-to-cart">Agregar al carrito</button>
      <div class="btn-group">
        <button class="btn-whatsapp-product">Consultar por WhatsApp</button>
        <button class="btn-tech">Ficha Técnica</button>
      </div>
    </div>

    <div class="product" data-id="3" data-name="Cámara EZVIZ DB1" data-price="100" data-specs="Resolución 1080p, Detección de movimiento, Audio bidireccional" data-tech="Modelo CS-DB1, Resolución 1080p, Detección de movimiento, Audio bidireccional, Almacenamiento microSD" data-fabricante="https://www.ezviz.com/la/product/db1/">
      <img src="https://www.example.com/ezviz-db1.jpg" alt="Cámara EZVIZ DB1" />
      <h3>Cámara EZVIZ DB1</h3>
      <div class="price">$100 USD</div>
      <div class="specs">Resolución 1080p, Detección de movimiento, Audio bidireccional</div>
      <input type="number" min="1" value="1" class="quantity-input" aria-label="Cantidad de Cámara EZVIZ DB1" />
      <button class="add-to-cart">Agregar al carrito</button>
      <div class="btn-group">
        <button class="btn-whatsapp-product">Consultar por WhatsApp</button>
        <button class="btn-tech">Ficha Técnica</button>
      </div>
    </div>

    <div class="product" data-id="4" data-name="Cámara EZVIZ BC1C" data-price="130" data-specs="Resolución 1080p, Visión nocturna, Audio bidireccional" data-tech="Modelo CS-BC1C, Resolución 1080p, Visión nocturna, Audio bidireccional, Almacenamiento microSD" data-fabricante="https://www.ezviz.com/la/product/bc1c/">
      <img src="https://www.example.com/ezviz-bc1c.jpg" alt="Cámara EZVIZ BC1C" />
      <h3>Cámara EZVIZ BC1C</h3>
      <div class="price">$130 USD</div>
      <div class="specs">Resolución 1080p, Visión nocturna, Audio bidireccional</div>
      <input type="number" min="1" value="1" class="quantity-input" aria-label="Cantidad de Cámara EZVIZ BC1C" />
      <button class="add-to-cart">Agregar al carrito</button>
      <div class="btn-group">
        <button class="btn-whatsapp-product">Consultar por WhatsApp</button>
        <button class="btn-tech">Ficha Técnica</button>
      </div>
    </div>

  </div>
</main>

<div id="cart-details" aria-live="polite" aria-atomic="true" aria-label="Detalles del carrito">
  <h2>Carrito de Compras</h2>
  <div id="cart-items"></div>
  <div id="cart-total">Total: $0 USD</div>
  
  <!-- Formulario agregado -->
  <form id="whatsapp-form">
    <label for="fullName">Nombre completo:</label>
    <input type="text" id="fullName" name="fullName" required placeholder="Nombre completo" />
    <label for="cedula">Cédula:</label>
    <input type="text" id="cedula" name="cedula" required placeholder="Número de cédula" />
    <label for="direccion">Dirección:</label>
    <textarea id="direccion" name="direccion" rows="2" required placeholder="Dirección completa"></textarea>
    <label for="telefono">Teléfono:</label>
    <input type="tel" id="telefono" name="telefono" required placeholder="Número telefónico" />
    <button type="submit" id="whatsapp-order" disabled>Solicitar por WhatsApp</button>
  </form>
</div>

<!-- Modal ficha técnica -->
<div id="tech-modal" class="modal" aria-modal="true" role="dialog" aria-labelledby="tech-title" aria-describedby="tech-description">
  <div class="modal-content">
    <span class="close-modal" aria-label="Cerrar">&times;</span>
    <h3 id="tech-title">Ficha Técnica</h3>
    <div id="tech-content" class="tech-content"></div>
    <button id="btn-fabricante" class="btn-fabricante" target="_blank" rel="noopener noreferrer">Ver en web del fabricante</button>
  </div>
</div>

<script>
  const cart = {};
  const phoneNumber = '+584143693311';
  const cartButton = document.getElementById('cart-button');
  const cartDetails = document.getElementById('cart-details');
  const cartCount = document.getElementById('cart-count');
  const cartItemsContainer = document.getElementById('cart-items');
  const cartTotal = document.getElementById('cart-total');
  const whatsappOrderBtn = document.getElementById('whatsapp-order');
  const whatsappForm = document.getElementById('whatsapp-form');

  function updateCartDisplay() {
    cartItemsContainer.innerHTML = '';
    let total = 0;
    let totalQuantity = 0;
    for (const id in cart) {
      const item = cart[id];
      total += item.price * item.quantity;
      totalQuantity += item.quantity;

      const div = document.createElement('div');
      div.className = 'cart-item';

      const detailsDiv = document.createElement('div');
      detailsDiv.className = 'cart-item-details';
      detailsDiv.textContent = `${item.name} - $${item.price} x`;

      const qtyInput = document.createElement('input');
      qtyInput.type = 'number';
      qtyInput.min = 1;
      qtyInput.value = item.quantity;
      qtyInput.className = 'cart-item-quantity';
      qtyInput.setAttribute('aria-label', `Cantidad de ${item.name} en el carrito`);
      qtyInput.onchange = (e) => {
        let val = parseInt(e.target.value);
        if (isNaN(val) || val < 1) {
          val = 1;
          e.target.value = 1;
        }
        cart[id].quantity = val;
        updateCartDisplay();
      };

      const subtotalSpan = document.createElement('span');
      subtotalSpan.textContent = ` = $${(item.price * item.quantity).toFixed(2)} USD`;

      const removeBtn = document.createElement('button');
      removeBtn.textContent = 'X';
      removeBtn.className = 'cart-remove-btn';
      removeBtn.setAttribute('aria-label', `Eliminar ${item.name} del carrito`);
      removeBtn.onclick = () => {
        delete cart[id];
        updateCartDisplay();
      };

      detailsDiv.appendChild(qtyInput);
      detailsDiv.appendChild(subtotalSpan);
      div.appendChild(detailsDiv);
      div.appendChild(removeBtn);
      cartItemsContainer.appendChild(div);
    }
    cartTotal.textContent = `Total: $${total.toFixed(2)} USD`;
    cartCount.textContent = totalQuantity;
    whatsappOrderBtn.disabled = totalQuantity === 0 || !whatsappForm.checkValidity();
  }

  function addToCart(product) {
    const id = product.getAttribute('data-id');
    const name = product.getAttribute('data-name');
    const price = Number(product.getAttribute('data-price'));
    const qtyInput = product.querySelector('.quantity-input');
    let quantity = parseInt(qtyInput.value);
    if (isNaN(quantity) || quantity < 1) {
      quantity = 1;
      qtyInput.value = 1;
    }
    if (cart[id]) {
      cart[id].quantity += quantity;
    } else {
      cart[id] = { name, price, quantity };
    }
    updateCartDisplay();
  }

  document.querySelectorAll('.add-to-cart').forEach(button => {
    button.onclick = (e) => {
      const product = e.target.closest('.product');
      addToCart(product);
    };
  });

  cartButton.onclick = () => {
    cartDetails.style.display = cartDetails.style.display === 'block' ? 'none' : 'block';
  };

  // Habilitar/deshabilitar botón de enviar según validación formulario y carrito
  whatsappForm.addEventListener('input', () => {
    whatsappOrderBtn.disabled = Object.keys(cart).length === 0 || !whatsappForm.checkValidity();
  });

  whatsappForm.addEventListener('submit', (e) => {
    e.preventDefault();
    if (Object.keys(cart).length === 0) {
      alert('El carrito está vacío.');
      return;
    }
    if (!whatsappForm.checkValidity()) {
      whatsappForm.reportValidity();
      return;
    }
    let message = 'Hola, quiero realizar el siguiente pedido:%0A';
    for (const id in cart) {
      const item = cart[id];
      message += `${item.name} - Cantidad: ${item.quantity} - Subtotal: $${(item.price * item.quantity).toFixed(2)} USD%0A`;
    }
    message += `${cartTotal.textContent}%0A%0A`;
    message += 'Datos del comprador:%0A';
    message += `Nombre completo: ${encodeURIComponent(whatsappForm.fullName.value)}%0A`;
    message += `Cédula: ${encodeURIComponent(whatsappForm.cedula.value)}%0A`;
    message += `Dirección: ${encodeURIComponent(whatsappForm.direccion.value)}%0A`;
    message += `Teléfono: ${encodeURIComponent(whatsappForm.telefono.value)}%0A`;
    message += '%0APor favor envíenme más información. Gracias.';

    const whatsappURL = `https://wa.me/${phoneNumber}?text=${message}`;
    window.open(whatsappURL, '_blank');
  });

  // WhatsApp consulta por producto
  document.querySelectorAll('.btn-whatsapp-product').forEach(button => {
    button.onclick = (e) => {
      const product = e.target.closest('.product');
      const name = product.getAttribute('data-name');
      const message = encodeURIComponent(`Hola, quiero consultar sobre el producto: ${name}. Por favor envíenme más información.`);
      const whatsappURL = `https://wa.me/${phoneNumber}?text=${message}`;
      window.open(whatsappURL, '_blank');
    };
  });

  // Modal ficha técnica
  const techModal = document.getElementById('tech-modal');
  const techContent = document.getElementById('tech-content');
  const closeModalBtn = document.querySelector('.close-modal');
  const btnFabricante = document.getElementById('btn-fabricante');
  let currentFabricanteUrl = '';

  document.querySelectorAll('.btn-tech').forEach(button => {
    button.onclick = (e) => {
      const product = e.target.closest('.product');
      const techText = product.getAttribute('data-tech');
      currentFabricanteUrl = product.getAttribute('data-fabricante') || '';
      techContent.textContent = techText;
      techModal.style.display = 'block';
      btnFabricante.style.display = currentFabricanteUrl ? 'block' : 'none';
    };
  });

  closeModalBtn.onclick = () => {
    techModal.style.display = 'none';
  };

  window.onclick = (event) => {
    if (event.target == techModal) {
      techModal.style.display = 'none';
    }
  };

  btnFabricante.onclick = () => {
    if (currentFabricanteUrl) {
      window.open(currentFabricanteUrl, '_blank', 'noopener');
    }
  };

  // Inicializa el carrito vacío
  updateCartDisplay();
</script>

</body>
</html>
